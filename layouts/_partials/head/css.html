{{- /* Consolidate all CSS under assets/css into a single processed file.
		 This concatenates the assets, runs PostCSS (root config), minifies and fingerprints. */ -}}
{{- /*
		Process FontAwesome as a per-theme resource to avoid different themes
		writing to the same target path and clobbering each other's output.

		Strategy:
		- Detect which theme/style folder is present for the current page by
			checking for the existence of `css/<theme>/styles.css` in `resources`.
		- If found, write the processed FontAwesome to `css/<theme>/fontawesome.css`.
		- Otherwise fall back to a global `css/fontawesome.css` target.

		This preserves your earlier `targetPath` per-theme trick while still
		running PostCSS/PurgeCSS on the resulting file.
*/ -}}
{{- $candidates := slice "one-page-alt" "one-page-pixels" "one-page" "home" "classic" -}}
{{- $.Scratch.Set "faTheme" "" -}}
{{- range $i, $t := $candidates -}}
	{{- with resources.Get (printf "css/%s/styles.css" $t) -}}
		{{- if eq ($.Scratch.Get "faTheme") "" -}}
			{{- $.Scratch.Set "faTheme" $t -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{- $theme := $.Scratch.Get "faTheme" -}}
{{- with resources.Get "css/fontawesome.css" -}}
	{{- $target := cond (ne $theme "") (printf "css/%s/fontawesome.css" $theme) "css/fontawesome.css" -}}
	{{- with resources.ExecuteAsTemplate $target $ . -}}
		{{- $fa := . | postCSS (dict "config" "postcss.config.js") | minify | fingerprint -}}
		<link rel="stylesheet" href="{{ $fa.RelPermalink }}" integrity="{{ $fa.Data.Integrity }}" crossorigin>
	{{- end -}}
{{- end -}}

{{- /* Load home page styles for the home template */ -}}
{{- if .IsHome -}}
	{{- with resources.Get "css/home/styles.css" -}}
		{{- $home := . | postCSS (dict "config" "postcss.config.js") | minify | fingerprint -}}
		<link rel="stylesheet" href="{{ $home.RelPermalink }}" integrity="{{ $home.Data.Integrity }}" crossorigin>
	{{- end -}}
{{- end -}}

{{- /* NOTE: theme/page CSS should be included by each layout/template to avoid cross-theme leakage. */ -}}
